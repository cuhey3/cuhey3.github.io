<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R4F9JM3PQ1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-R4F9JM3PQ1');
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=1150px, target-density=device-dpi">
    <meta name="description" content="SFLの勝ち抜けチームをイロレーティングを使用してシミュレーションします">
    <title>SFL2024勝ち抜けシミュレーション</title>
    <style>
        body {
            min-height: 200em;
            padding: 0;
            margin: 0;
            /*font-family: "游ゴシック","メイリオ", sans-serif;*/
            font-family: "Hiragino Kaku Gothic ProN";
            background-image: radial-gradient(rgba(70, 25, 122, 1), rgba(23, 0, 42, 1));
            color: #ddd;
        }

        .container {
            padding-left: 1.8em;
            margin: 0;
        }

        table {
            text-align: center;
            margin-bottom: 1em;
            border-collapse: collapse;
        }

        tbody tr, tbody th, tbody td {
            border: 1px solid #999;
            border-collapse: collapse;
        }

        th, td {
            padding: 0.8em;
            height: 1.5em;
        }

        dd {
            margin-left: 2em;
        }

        ul {
            padding: 1em;
        }

        .percent {
            text-align: right;
            min-width: 3.2em;
        }

        input[type="radio"] {
            cursor: pointer;
        }

        #loader {
            padding: 0;
            position: fixed;
            text-align: center;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            z-index: -1;
            background-color: #222;
            display: table;
            color: #fff;
        }

        #loader p {
            font-size: 3em;
            display: table-cell;
            vertical-align: middle;
        }

        h2 {
            cursor: pointer;
            margin: 0.4em auto;
        }

        h2 {
            font-weight: 500;
        }

        h3, th {
            font-weight: 900;
        }

        h2:before {
            content: '';
            display: inline-block;
            vertical-align: middle;
            width: 0.85em;
            height: 0.95em;
            background-size: contain;
            background-repeat: no-repeat;
            margin-right: 0.2em;
        }

        h2.right:before {
            background-image: url(./images/right-arrow.png?t=202408291600);
        }

        h2.down:before {
            background-image: url(./images/down-arrow.png?t=202408291600);
        }

        #simulate {
            vertical-align: middle;
            display: inline-block;
            margin-left: 0.7em;
            margin-right: 0.7em;
        }

        #clear {
            vertical-align: middle;
            display: inline-block;
        }

        .show {
            display: block;
        }

        .hide {
            display: none;
        }

        .expand-area {
            margin: 0.8em auto 2em;
            padding-left: 1.6em;
        }

        a[href] {
            color: #99C3FF;
        }

        .script-init {
            visibility: hidden;
        }

        /* モーダルと背景の指定 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            text-align: center;
            color: #000;
            background: rgba(0, 0, 0, 50%);
            padding: 40px 20px;
            overflow: auto;
            opacity: 0;
            visibility: hidden;
            transition: .3s;
            box-sizing: border-box;
        }

        /* モーダルの擬似要素の指定 */
        .modal:before {
            content: "";
            display: inline-block;
            vertical-align: middle;
            height: 100%;
            margin-left: -0.2em;
        }

        /* クラスが追加された時の指定 */
        .modal.is-active {
            opacity: 1;
            visibility: visible;
        }

        /* モーダル内側の指定 */
        .modal-container {
            position: relative;
            display: inline-block;
            vertical-align: middle;
            min-width: 30em;
            /*min-width: 65%;*/
        }

        /* モーダルを閉じるボタンの指定 */
        .modal-close {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            top: -20px;
            right: -20px;
            width: 40px;
            height: 40px;
            color: #fff;
            background: #000;
            border-radius: 50%;
            cursor: pointer;
        }

        /* モーダルのコンテンツ部分の指定 */
        .modal-content {
            background: #fff;
            text-align: left;
            line-height: 1.8;
            padding: 20px;
        }

        /* モーダルのコンテンツ部分のテキストの指定 */
        .modal-content p {
            margin: 1em 0;
        }

        .modal-table tbody th {
            text-align: left;
        }

        .modal-table tbody td {
            padding: 0.3em;
        }
    </style>
    <meta name="google-site-verification" content="xHHEihBbGTkulHW5I_nPIqjB8Xnj8pitqNxMe-Wlvgo"/>
</head>
<body>
<div id="loader"><p>シミュレーションしています...</p></div>
<div class="container">
    <h1>SFL2024勝ち抜けシミュレーション</h1>
    <span id="before-match-info" class="script-init">0/00 ディビジョンN 第0節の結果を反映</span><br>
    <p><a href="https://sf.esports.capcom.com/sp/sfl/2024/ranking/" target="_blank">SFL公式ランキングへ</a></p>
    <p><a href="transition.html" target="_blank">プレイオフ進出確率 推移表</a></p>
    <dl>
        <dt>
            [シミュレーションの説明]
        </dt>
        <dd>
            現在までに行われた試合結果に、今後の試合結果をランダムに生成して加え、10000回シミュレーションしています。
        </dd>
        <dd>
            また1バトル（1セット）ごとにイロレーティングを算出し、今後の試合結果のランダム生成に反映しています。
        </dd>
    </dl>
    <div style="height: 2em;">
        <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large"
           data-hashtags="SFリーグ" data-lang="ja" data-show-count="false">Tweet</a>
        <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    </div>
    <h2>ディビジョンS</h2>
    <div class="show expand-area">
        <table>
            <thead>
            <tr>
                <th>チーム</th>
                <th>プレイオフ<br>進出確率</th>
                <th>ポイント<br>現在</th>
                <th>ポイント<br>予想</th>
                <th>バトル<br>得失現在</th>
                <th>バトル<br>得失予想</th>
                <th>1位<br>確率</th>
                <th>2位<br>確率</th>
                <th>3位<br>確率</th>
                <th>4位<br>確率</th>
                <th>5位<br>確率</th>
                <th>6位<br>確率</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <th id="s-0-0"></th>
                <th id="s-0-19" class="percent"></th>
                <td id="s-0-7"></td>
                <td><a href="" id="s-0-8" class="js-modal-open"></a></td>
                <td id="s-0-9"></td>
                <td id="s-0-10"></td>
                <td id="s-0-1" class="percent"></td>
                <td id="s-0-2" class="percent"></td>
                <td id="s-0-3" class="percent"></td>
                <td id="s-0-4" class="percent"></td>
                <td id="s-0-5" class="percent"></td>
                <td id="s-0-6" class="percent"></td>
            </tr>
            <tr>
                <th id="s-1-0"></th>
                <th id="s-1-19" class="percent"></th>
                <td id="s-1-7"></td>
                <td><a href="" id="s-1-8" class="js-modal-open"></a></td>
                <td id="s-1-9"></td>
                <td id="s-1-10"></td>
                <td id="s-1-1" class="percent"></td>
                <td id="s-1-2" class="percent"></td>
                <td id="s-1-3" class="percent"></td>
                <td id="s-1-4" class="percent"></td>
                <td id="s-1-5" class="percent"></td>
                <td id="s-1-6" class="percent"></td>
            </tr>
            <tr>
                <th id="s-2-0"></th>
                <th id="s-2-19" class="percent"></th>
                <td id="s-2-7"></td>
                <td><a href="" id="s-2-8" class="js-modal-open"></a></td>
                <td id="s-2-9"></td>
                <td id="s-2-10"></td>
                <td id="s-2-1" class="percent"></td>
                <td id="s-2-2" class="percent"></td>
                <td id="s-2-3" class="percent"></td>
                <td id="s-2-4" class="percent"></td>
                <td id="s-2-5" class="percent"></td>
                <td id="s-2-6" class="percent"></td>
            </tr>
            <tr>
                <th id="s-3-0"></th>
                <th id="s-3-19" class="percent"></th>
                <td id="s-3-7"></td>
                <td><a href="" id="s-3-8" class="js-modal-open"></a></td>
                <td id="s-3-9"></td>
                <td id="s-3-10"></td>
                <td id="s-3-1" class="percent"></td>
                <td id="s-3-2" class="percent"></td>
                <td id="s-3-3" class="percent"></td>
                <td id="s-3-4" class="percent"></td>
                <td id="s-3-5" class="percent"></td>
                <td id="s-3-6" class="percent"></td>
            </tr>
            <tr>
                <th id="s-4-0"></th>
                <th id="s-4-19" class="percent"></th>
                <td id="s-4-7"></td>
                <td><a href="" id="s-4-8" class="js-modal-open"></a></td>
                <td id="s-4-9"></td>
                <td id="s-4-10"></td>
                <td id="s-4-1" class="percent"></td>
                <td id="s-4-2" class="percent"></td>
                <td id="s-4-3" class="percent"></td>
                <td id="s-4-4" class="percent"></td>
                <td id="s-4-5" class="percent"></td>
                <td id="s-4-6" class="percent"></td>
            </tr>
            <tr>
                <th id="s-5-0"></th>
                <th id="s-5-19" class="percent"></th>
                <td id="s-5-7"></td>
                <td><a href="" id="s-5-8" class="js-modal-open"></a></td>
                <td id="s-5-9"></td>
                <td id="s-5-10"></td>
                <td id="s-5-1" class="percent"></td>
                <td id="s-5-2" class="percent"></td>
                <td id="s-5-3" class="percent"></td>
                <td id="s-5-4" class="percent"></td>
                <td id="s-5-5" class="percent"></td>
                <td id="s-5-6" class="percent"></td>
            </tr>
            </tbody>
        </table>
    </div>
    <h2 class="right">試合結果を入力（ディビジョンS 第8節〜）</h2>
    <div class="hide expand-area" id="simulation-parent-s">
        <p>試合結果が当サイトに反映される前でも、ご自身で任意の試合結果を入力し、シミュレーションを行うことができます。</p>
    </div>
    <h2>ディビジョンF</h2>
    <div class="show expand-area">
        <table>
            <thead>
            <tr>
                <th>チーム</th>
                <th>プレイオフ<br>進出確率</th>
                <th>ポイント<br>現在</th>
                <th>ポイント<br>予想</th>
                <th>バトル<br>得失現在</th>
                <th>バトル<br>得失予想</th>
                <th>1位<br>確率</th>
                <th>2位<br>確率</th>
                <th>3位<br>確率</th>
                <th>4位<br>確率</th>
                <th>5位<br>確率</th>
                <th>6位<br>確率</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <th id="f-0-0"></th>
                <th id="f-0-19" class="percent"></th>
                <td id="f-0-7"></td>
                <td><a href="" id="f-0-8" class="js-modal-open"></a></td>
                <td id="f-0-9"></td>
                <td id="f-0-10"></td>
                <td id="f-0-1" class="percent"></td>
                <td id="f-0-2" class="percent"></td>
                <td id="f-0-3" class="percent"></td>
                <td id="f-0-4" class="percent"></td>
                <td id="f-0-5" class="percent"></td>
                <td id="f-0-6" class="percent"></td>
            </tr>
            <tr>
                <th id="f-1-0"></th>
                <th id="f-1-19" class="percent"></th>
                <td id="f-1-7"></td>
                <td><a href="" id="f-1-8" class="js-modal-open"></a></td>
                <td id="f-1-9"></td>
                <td id="f-1-10"></td>
                <td id="f-1-1" class="percent"></td>
                <td id="f-1-2" class="percent"></td>
                <td id="f-1-3" class="percent"></td>
                <td id="f-1-4" class="percent"></td>
                <td id="f-1-5" class="percent"></td>
                <td id="f-1-6" class="percent"></td>
            </tr>
            <tr>
                <th id="f-2-0"></th>
                <th id="f-2-19" class="percent"></th>
                <td id="f-2-7"></td>
                <td><a href="" id="f-2-8" class="js-modal-open"></a></td>
                <td id="f-2-9"></td>
                <td id="f-2-10"></td>
                <td id="f-2-1" class="percent"></td>
                <td id="f-2-2" class="percent"></td>
                <td id="f-2-3" class="percent"></td>
                <td id="f-2-4" class="percent"></td>
                <td id="f-2-5" class="percent"></td>
                <td id="f-2-6" class="percent"></td>
            </tr>
            <tr>
                <th id="f-3-0"></th>
                <th id="f-3-19" class="percent"></th>
                <td id="f-3-7"></td>
                <td><a href="" id="f-3-8" class="js-modal-open"></a></td>
                <td id="f-3-9"></td>
                <td id="f-3-10"></td>
                <td id="f-3-1" class="percent"></td>
                <td id="f-3-2" class="percent"></td>
                <td id="f-3-3" class="percent"></td>
                <td id="f-3-4" class="percent"></td>
                <td id="f-3-5" class="percent"></td>
                <td id="f-3-6" class="percent"></td>
            </tr>
            <tr>
                <th id="f-4-0"></th>
                <th id="f-4-19" class="percent"></th>
                <td id="f-4-7"></td>
                <td><a href="" id="f-4-8" class="js-modal-open"></a></td>
                <td id="f-4-9"></td>
                <td id="f-4-10"></td>
                <td id="f-4-1" class="percent"></td>
                <td id="f-4-2" class="percent"></td>
                <td id="f-4-3" class="percent"></td>
                <td id="f-4-4" class="percent"></td>
                <td id="f-4-5" class="percent"></td>
                <td id="f-4-6" class="percent"></td>
            </tr>
            <tr>
                <th id="f-5-0"></th>
                <th id="f-5-19" class="percent"></th>
                <td id="f-5-7"></td>
                <td><a href="" id="f-5-8" class="js-modal-open"></a></td>
                <td id="f-5-9"></td>
                <td id="f-5-10"></td>
                <td id="f-5-1" class="percent"></td>
                <td id="f-5-2" class="percent"></td>
                <td id="f-5-3" class="percent"></td>
                <td id="f-5-4" class="percent"></td>
                <td id="f-5-5" class="percent"></td>
                <td id="f-5-6" class="percent"></td>
            </tr>
            </tbody>
        </table>
    </div>
    <h2 class="right">試合結果を入力（ディビジョンF 第8節〜）</h2>
    <div class="hide expand-area" id="simulation-parent-f">
        <p>試合結果が当サイトに反映される前でも、ご自身で任意の試合結果を入力し、シミュレーションを行うことができます。</p>
    </div>
    <h2 style="margin-bottom:0">レーティング</h2>
    <div class="show expand-area">
        <div style="float:left;margin-right: 1.8em;">
            <h3 style="margin-top: 0;margin-bottom: 0.5em">ディビジョンS</h3>
            <table>
                <thead>
                <tr>
                    <th>チーム</th>
                    <th>先鋒・中堅<br>AWAY</th>
                    <th>先鋒・中堅<br>HOME</th>
                    <th>大将・延長<br>AWAY</th>
                    <th>大将・延長<br>HOME</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="s-0-0"></td>
                    <td id="s-0-11"></td>
                    <td id="s-0-12"></td>
                    <td id="s-0-13"></td>
                    <td id="s-0-14"></td>
                </tr>
                <tr>
                    <td class="s-1-0"></td>
                    <td id="s-1-11"></td>
                    <td id="s-1-12"></td>
                    <td id="s-1-13"></td>
                    <td id="s-1-14"></td>
                </tr>
                <tr>
                    <td class="s-2-0"></td>
                    <td id="s-2-11"></td>
                    <td id="s-2-12"></td>
                    <td id="s-2-13"></td>
                    <td id="s-2-14"></td>

                </tr>
                <tr>
                    <td class="s-3-0"></td>
                    <td id="s-3-11"></td>
                    <td id="s-3-12"></td>
                    <td id="s-3-13"></td>
                    <td id="s-3-14"></td>

                </tr>
                <tr>
                    <td class="s-4-0"></td>
                    <td id="s-4-11"></td>
                    <td id="s-4-12"></td>
                    <td id="s-4-13"></td>
                    <td id="s-4-14"></td>
                </tr>
                <tr>
                    <td class="s-5-0"></td>
                    <td id="s-5-11"></td>
                    <td id="s-5-12"></td>
                    <td id="s-5-13"></td>
                    <td id="s-5-14"></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div style="float:left;">
            <h3 style="margin-top: 0;margin-bottom: 0.5em">ディビジョンF</h3>
            <table>
                <thead>
                <tr>
                    <th>チーム</th>
                    <th>先鋒・中堅<br>AWAY</th>
                    <th>先鋒・中堅<br>HOME</th>
                    <th>大将・延長<br>AWAY</th>
                    <th>大将・延長<br>HOME</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="f-0-0"></td>
                    <td id="f-0-11"></td>
                    <td id="f-0-12"></td>
                    <td id="f-0-13"></td>
                    <td id="f-0-14"></td>
                </tr>
                <tr>
                    <td class="f-1-0"></td>
                    <td id="f-1-11"></td>
                    <td id="f-1-12"></td>
                    <td id="f-1-13"></td>
                    <td id="f-1-14"></td>

                </tr>
                <tr>
                    <td class="f-2-0"></td>
                    <td id="f-2-11"></td>
                    <td id="f-2-12"></td>
                    <td id="f-2-13"></td>
                    <td id="f-2-14"></td>

                </tr>
                <tr>
                    <td class="f-3-0"></td>
                    <td id="f-3-11"></td>
                    <td id="f-3-12"></td>
                    <td id="f-3-13"></td>
                    <td id="f-3-14"></td>

                </tr>
                <tr>
                    <td class="f-4-0"></td>
                    <td id="f-4-11"></td>
                    <td id="f-4-12"></td>
                    <td id="f-4-13"></td>
                    <td id="f-4-14"></td>
                </tr>
                <tr>
                    <td class="f-5-0"></td>
                    <td id="f-5-11"></td>
                    <td id="f-5-12"></td>
                    <td id="f-5-13"></td>
                    <td id="f-5-14"></td>
                </tr>
                </tbody>
            </table>
        </div>
        <p style="clear: both; padding-top: 0.2em;">
            ※レーティングは上記の区分ごとに、1バトル（1セット）ごとに変動するよう計算しています。<br>
            ※プレイヤーやキャラクター、またその相性はレーティングの計算には含まれていません。</p>
    </div>
    <h2>プレイオフ / グランドファイナル優勝確率</h2>
    <div class="show expand-area">
        <table>
            <thead>
            <tr>
                <th class="gf-0-0">チーム<br>(ディビジョン)</th>
                <th>プレイオフ<br>進出確率</th>
                <th>GF<br>優勝確率</th>
                <th>2位<br>確率</th>
                <th>3位<br>確率</th>
                <th>5位<br>確率</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td id="gf-0-0"></td>
                <td id="gf-0-19" class="percent">00.0%</td>
                <td id="gf-0-15" class="percent">00.0%</td>
                <td id="gf-0-16" class="percent">00.0%</td>
                <td id="gf-0-17" class="percent">00.0%</td>
                <td id="gf-0-18" class="percent">00.0%</td>
            </tr>
            <tr>
                <td id="gf-1-0"></td>
                <td id="gf-1-19" class="percent">00.0%</td>
                <td id="gf-1-15" class="percent">00.0%</td>
                <td id="gf-1-16" class="percent">00.0%</td>
                <td id="gf-1-17" class="percent">00.0%</td>
                <td id="gf-1-18" class="percent">00.0%</td>
            </tr>
            <tr>
                <td id="gf-2-0"></td>
                <td id="gf-2-19" class="percent">00.0%</td>
                <td id="gf-2-15" class="percent">00.0%</td>
                <td id="gf-2-16" class="percent">00.0%</td>
                <td id="gf-2-17" class="percent">00.0%</td>
                <td id="gf-2-18" class="percent">00.0%</td>
            </tr>
            <tr>
                <td id="gf-3-0"></td>
                <td id="gf-3-19" class="percent">00.0%</td>
                <td id="gf-3-15" class="percent">00.0%</td>
                <td id="gf-3-16" class="percent">00.0%</td>
                <td id="gf-3-17" class="percent">00.0%</td>
                <td id="gf-3-18" class="percent">00.0%</td>
            </tr>
            <tr>
                <td id="gf-4-0"></td>
                <td id="gf-4-19" class="percent">00.0%</td>
                <td id="gf-4-15" class="percent">00.0%</td>
                <td id="gf-4-16" class="percent">00.0%</td>
                <td id="gf-4-17" class="percent">00.0%</td>
                <td id="gf-4-18" class="percent">00.0%</td>
            </tr>
            <tr>
                <td id="gf-5-0"></td>
                <td id="gf-5-19" class="percent">00.0%</td>
                <td id="gf-5-15" class="percent">00.0%</td>
                <td id="gf-5-16" class="percent">00.0%</td>
                <td id="gf-5-17" class="percent">00.0%</td>
                <td id="gf-5-18" class="percent">00.0%</td>
            </tr>
            <tr>
                <td id="gf-6-0"></td>
                <td id="gf-6-19" class="percent">00.0%</td>
                <td id="gf-6-15" class="percent">00.0%</td>
                <td id="gf-6-16" class="percent">00.0%</td>
                <td id="gf-6-17" class="percent">00.0%</td>
                <td id="gf-6-18" class="percent">00.0%</td>
            </tr>
            <tr>
                <td id="gf-7-0"></td>
                <td id="gf-7-19" class="percent">00.0%</td>
                <td id="gf-7-15" class="percent">00.0%</td>
                <td id="gf-7-16" class="percent">00.0%</td>
                <td id="gf-7-17" class="percent">00.0%</td>
                <td id="gf-7-18" class="percent">00.0%</td>
            </tr>
            <tr>
                <td id="gf-8-0"></td>
                <td id="gf-8-19" class="percent">00.0%</td>
                <td id="gf-8-15" class="percent">00.0%</td>
                <td id="gf-8-16" class="percent">00.0%</td>
                <td id="gf-8-17" class="percent">00.0%</td>
                <td id="gf-8-18" class="percent">00.0%</td>
            </tr>
            <tr>
                <td id="gf-9-0"></td>
                <td id="gf-9-19" class="percent">00.0%</td>
                <td id="gf-9-15" class="percent">00.0%</td>
                <td id="gf-9-16" class="percent">00.0%</td>
                <td id="gf-9-17" class="percent">00.0%</td>
                <td id="gf-9-18" class="percent">00.0%</td>
            </tr>
            <tr>
                <td id="gf-10-0"></td>
                <td id="gf-10-19" class="percent">00.0%</td>
                <td id="gf-10-15" class="percent">00.0%</td>
                <td id="gf-10-16" class="percent">00.0%</td>
                <td id="gf-10-17" class="percent">00.0%</td>
                <td id="gf-10-18" class="percent">00.0%</td>
            </tr>
            <tr>
                <td id="gf-11-0"></td>
                <td id="gf-11-19" class="percent">00.0%</td>
                <td id="gf-11-15" class="percent">00.0%</td>
                <td id="gf-11-16" class="percent">00.0%</td>
                <td id="gf-11-17" class="percent">00.0%</td>
                <td id="gf-11-18" class="percent">00.0%</td>
            </tr>
            </tbody>
        </table>
        <p style="clear: both; padding-top: 0.2em;">
            ※プレイオフは70ポイント、グランドファイナルは90ポイント獲得で勝利となります。<br>
            ※グランドファイナルは、本節のポイント・バトル得失が多い方がHOMEとなります。</p>
    </div>
    <!-- モーダル本体 -->
    <div class="modal js-modal">
        <div class="modal-container">
            <!-- モーダルを閉じるボタン -->
            <div class="modal-close js-modal-close">×</div>
            <!-- モーダル内部のコンテンツ -->
            <div class="modal-content">
                <h3 id="modal-content-text"></h3>
                <table class="modal-table">
                    <thead>
                    <tr>
                        <td></td>
                        <td>1節</td>
                        <td>2節</td>
                        <td>3節</td>
                        <td>4節</td>
                        <td>5節</td>
                        <td>6節</td>
                        <td>7節</td>
                        <td>8節</td>
                        <td>9節</td>
                        <td>10節</td>
                        <td>合計</td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="opponent">
                        <th>対戦相手</th>
                        <td>IBS</td>
                        <td>SNB</td>
                        <td>3節</td>
                        <td>4節</td>
                        <td>5節</td>
                        <td>6節</td>
                        <td>7節</td>
                        <td>8節</td>
                        <td>9節</td>
                        <td>10節</td>
                        <td>合計</td>
                    </tr>
                    <tr class="home-away">
                        <th>HOME / AWAY</th>
                        <td>HOME</td>
                        <td>AWAY</td>
                        <td>3節</td>
                        <td>4節</td>
                        <td>5節</td>
                        <td>6節</td>
                        <td>7節</td>
                        <td>8節</td>
                        <td>9節</td>
                        <td>10節</td>
                        <td>合計</td>
                    </tr>
                    <tr class="point-total">
                        <th>ポイント実績・予想</th>
                        <td>20.8</td>
                        <td>20.8</td>
                        <td>3節</td>
                        <td>4節</td>
                        <td>5節</td>
                        <td>6節</td>
                        <td>7節</td>
                        <td>8節</td>
                        <td>9節</td>
                        <td>10節</td>
                        <td> -</td>
                    </tr>
                    <tr class="point-van">
                        <th>先鋒戦・中堅戦</th>
                        <td>10.4</td>
                        <td>10.4</td>
                        <td>3節</td>
                        <td>4節</td>
                        <td>5節</td>
                        <td>6節</td>
                        <td>7節</td>
                        <td>8節</td>
                        <td>9節</td>
                        <td>10節</td>
                        <td>合計</td>
                    </tr>
                    <tr class="point-general">
                        <th>大将戦・延長戦</th>
                        <td>10.4</td>
                        <td>10.4</td>
                        <td>3節</td>
                        <td>4節</td>
                        <td>5節</td>
                        <td>6節</td>
                        <td>7節</td>
                        <td>8節</td>
                        <td>9節</td>
                        <td>10節</td>
                        <td>合計</td>
                    </tr>
                    <tr class="team-van-rating">
                        <th>SOLの先鋒戦レート</th>
                        <td>10.4</td>
                        <td>10.4</td>
                        <td>3節</td>
                        <td>4節</td>
                        <td>5節</td>
                        <td>6節</td>
                        <td>7節</td>
                        <td>8節</td>
                        <td>9節</td>
                        <td>10節</td>
                        <td>合計</td>
                    </tr>
                    <tr class="opponent-van-rating">
                        <th>相手の先鋒戦レート</th>
                        <td>10.4</td>
                        <td>10.4</td>
                        <td>3節</td>
                        <td>4節</td>
                        <td>5節</td>
                        <td>6節</td>
                        <td>7節</td>
                        <td>8節</td>
                        <td>9節</td>
                        <td>10節</td>
                        <td>合計</td>
                    </tr>
                    <tr class="team-general-rating">
                        <th>SOLの大将戦レート</th>
                        <td>10.4</td>
                        <td>10.4</td>
                        <td>3節</td>
                        <td>4節</td>
                        <td>5節</td>
                        <td>6節</td>
                        <td>7節</td>
                        <td>8節</td>
                        <td>9節</td>
                        <td>10節</td>
                        <td>合計</td>
                    </tr>
                    <tr class="opponent-general-rating">
                        <th>相手の大将戦レート</th>
                        <td>1500.0</td>
                        <td>1500.0</td>
                        <td>1500.0</td>
                        <td>1500.0</td>
                        <td>1500.0</td>
                        <td>1500.0</td>
                        <td>1500.0</td>
                        <td>1500.0</td>
                        <td>1500.0</td>
                        <td>1500.0</td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script type="module">
    import init, {SflSimulation, SflStage} from "./pkg/sfl_lib.js?t=202410222200";

    await init();
    const {JP2024DivisionS, JP2024DivisionF, JP2024AllDivision} = SflStage;

    // サイト更新時修正1/1(対象のディビジョンに新節の分だけを貼り付けて追加)
    // 入力がない状態でシミュレートをした時に、シミュレート結果が変わらないことを確認する
    const getDivisionResults = () => [
        // S-1節
        [true, true, false, false, true, true, false, true, false, true, false, true,],
        [true, true, false, true, false, true, true, true, true, false],
        [true, false, true, true, false, true, false, false, true, true, false, true,],
        // F-1節
        [true, true, false, false, true, false, true, true, false, false, false, false,],
        [false, false, false, true, true, false, false, true, false, true, true, false,],
        [false, false, false, true, true, false, true, true, true, false, false, false,],
        // S-2節
        [false, false, false, false, true, true, true, false, true, true, false, false,],
        [true, true, false, true, false, true, false, true, false, false, false, false,],
        [false, true, false, false, true, true, false, false, true, true, true, false,],
        // F-2節
        [false, false, false, true, true, false, false, false, false],
        [false, true, false, false, true, false, false, true, false, false],
        [false, false, false, false, false, false, false, true, false, true, false],
        // S-3節
        [true, true, false, false, true, false, false, true, false, true, true],
        [true, true, false, true, true, false, false, true, true, false, true],
        [false, false, false, true, false, false, true, true, true, false, false, false],
        // F-3節
        [true, false, true, true, true, false, false, false, false, false, false, false],
        [true, false, true, true, true, false, true, false, false, false, false, false],
        [false, true, true, true, true, false, true, true, true],
        // S-4節
        [true, false, true, false, false, false, true, true, true],
        [false, true, true, false, false, false, false, true, true, true],
        [true, true, false, true, false, false, true, true, true],
        // F-4節
        [false, false, false, true, false, false, true, true, true, false, false, false],
        [false, true, false, false, true, false, false, false, false],
        [true, false, false, false, true, false, true, false, false, true, false],
        // S-5節
        [false, false, false, false, true, true, false, true, false, false],
        [false, false, false, true, true, false, false, false, false],
        [false, false, false, false, false, false, false, true, false, false],
        // F-5節
        [true, false, false, false, false, false, true, true, true, false, false, false],
        [true, false, true, false, true, false, true, true, true],
        [false, false, false, false, false, false, false, true, true, false, true, false],
        // S-6節
        [true, false, false, false, false, false, true, true, false, false, false, false],
        [true, false, true, true, true, false, false, true, true, true],
        [true, true, false, false, false, false, true, false, false, true, true],
        // F-6節
        [false, true, true, true, true, false, false, false, true, true, false, false],
        [true, true, false, false, true, true, true, true, true],
        [false, false, false, true, false, true, false, true, true, false, false],
        // S-7節
        [false, false, false, true, true, false, false, true, true, true],
        [false, true, false, false, true, false, true, true, false, false, true, true],
        [false, false, false, false, false, false, true, false, true, false, false],
        // F-7節
        [false, false, false, false, true, false, false, true, false, false],
        [true, true, false, true, true, false, false, true, false, true, true],
        [false, false, false, false, true, false, true, true, true, false, false, true],
    ];

    const simulation = new SflSimulation(true);
    const allTeamNames = simulation.get_team_names(JP2024AllDivision);
    getDivisionResults().forEach((results, index) => {
        simulation.set_match_result(index, results);
    });

    const matches = simulation.get_matches();
    // 残り3節固定
    const lastMatchIndex = getDivisionResults().length - 1;
    const beforeMatch1 = matches[lastMatchIndex - 2];
    let beforeMatchInfo = document.getElementById('before-match-info');
    beforeMatchInfo.innerHTML
        = `${beforeMatch1.date_expression.replace(/^0/, '').replace(/\/0/, '/')} ディビジョン${beforeMatch1.team < 6 ? 'S' : 'F'} 第${beforeMatch1.section}節の結果を反映`;

    document.querySelectorAll('h2').forEach((element) => {
        if (!element.classList.contains('right')) {
            element.classList.add('down');
        }
        element.onclick = function () {
            if (element.classList.contains('right')) {
                element.classList.replace('right', 'down');
                element.nextElementSibling.classList.replace('hide', 'show');
            } else {
                element.classList.replace('down', 'right');
                element.nextElementSibling.classList.replace('show', 'hide');
            }
        }
    });

    function drawTables() {
        [JP2024DivisionS, JP2024DivisionF].forEach((stage, index) => {
            simulation.get_current_places(stage).forEach((teamIndex, i) => {
                const teamName = allTeamNames[teamIndex];
                const divisionSign = index === 0 ? 's' : 'f';
                const placeCount = simulation.get_place_count(teamIndex < 6 ? JP2024DivisionS : JP2024DivisionF, teamIndex);
                document.querySelectorAll(`.${divisionSign}-${i}-0,#${divisionSign}-${i}-0`).forEach((element) => {
                    element.innerHTML = teamName;
                });
                [
                    [1, formatPercent(placeCount[0])],
                    [2, formatPercent(placeCount[1])],
                    [3, formatPercent(placeCount[2])],
                    [4, formatPercent(placeCount[3])],
                    [5, formatPercent(placeCount[4])],
                    [6, formatPercent(placeCount[5])],
                    [7, simulation.sfl_stats.get_points()[teamIndex].toString()],
                    [8, formatPoint(simulation.get_expect_point(teamIndex))],
                    [9, simulation.sfl_stats.get_battles()[teamIndex].toString()],
                    [10, formatPoint(simulation.get_expect_battle(teamIndex))],
                    [11, formatRating(simulation.get_rating(teamIndex, false, false).toString())],
                    [12, formatRating(simulation.get_rating(teamIndex, true, false).toString())],
                    [13, formatRating(simulation.get_rating(teamIndex, false, true).toString())],
                    [14, formatRating(simulation.get_rating(teamIndex, true, true).toString())],
                    [19, formatPercent(placeCount[0] + placeCount[1] + placeCount[2])]
                ].forEach((data) => {
                    document.querySelector(`#${divisionSign}-${i}-${data[0]}`).innerHTML = data[1];
                });
                document.getElementById(`${divisionSign}-${i}-8`).onclick = function (event) {
                    event.preventDefault();
                    modal.classList.add('is-active');
                    document.getElementById('modal-content-text').innerText = `${teamName}のポイント実績・予想`;
                    drawModal(teamIndex);
                }
            });
        });
        simulation.get_current_places(JP2024AllDivision).forEach((teamIndex, i) => {
            const placeCount = simulation.get_place_count(teamIndex < 6 ? JP2024DivisionS : JP2024DivisionF, teamIndex);
            const playoffPlaceCount = simulation.get_place_count(JP2024AllDivision, teamIndex);
            [
                [0, `${allTeamNames[teamIndex]} (${teamIndex < 6 ? 'S' : 'F'})`],
                [19, formatPercent(placeCount[0] + placeCount[1] + placeCount[2])],
                [15, formatPercent(playoffPlaceCount[0])],
                [16, formatPercent(playoffPlaceCount[1])],
                [17, formatPercent(playoffPlaceCount[2])],
                [18, formatPercent(playoffPlaceCount[3])],
            ].forEach((data) => {
                document.querySelector(`#gf-${i}-${data[0]}`).innerHTML = data[1];
            })
        });
    }

    function formatRating(rawRating) {
        return Math.round(rawRating * 10).toString().replace(/(.)$/, '.$1');
    }

    function formatPoint(rawPoint) {
        if (Math.round(Math.abs(rawPoint) / 1000) < 10) {
            rawPoint = (Math.round(rawPoint / 1000)).toString().replace(/(.)$/, '0.$1');
        } else {
            rawPoint = (Math.round(rawPoint / 1000)).toString().replace(/(.)$/, '.$1');
        }
        return rawPoint;
    }

    function formatPercent(rawNumber) {
        const rounded = Math.round(rawNumber / 10).toString();
        if (rounded < 10) {
            return rounded.replace(/(.)$/, '0.$1%');
        } else {
            return rounded.replace(/(.)$/, '.$1%');
        }
    }

    function drawModal(teamIndex) {
        const teamMatches = simulation.get_matches().map((m, index) => [m, index]).filter((m) => m[0].team === teamIndex || m[0].opponent_team === teamIndex);
        const opponentTeams = teamMatches.map((m) => m[0].team === teamIndex ? m[0].opponent_team : m[0].team);
        const homeAwayArray = teamMatches.map((m) => m[0].team === teamIndex ? 'AWAY' : 'HOME');
        document.querySelectorAll('.modal-table .opponent td').forEach((element, index) => {
            element.innerText = allTeamNames[opponentTeams[index]] || '-';
        });
        document.querySelectorAll('.modal-table .home-away td').forEach((element, index) => {
            element.innerText = homeAwayArray[index] || '-';
        });
        let pointTotalAll = 0;
        document.querySelectorAll('.modal-table .point-total td').forEach((element, index) => {
            const isHome = homeAwayArray[index] === 'HOME';
            if (index < 10) {
                const matchIndex = teamMatches[index][1];
                const points = simulation.get_match_points(matchIndex);
                let point = isHome ? points[1] + points[3] : points[0] + points[2];
                pointTotalAll += point;
                element.innerText = formatPoint(point);
            } else {
                element.innerText = formatPoint(pointTotalAll);
            }
        });
        let pointVanAll = 0;
        document.querySelectorAll('.modal-table .point-van td').forEach((element, index) => {
            const isHome = homeAwayArray[index] === 'HOME';
            if (index < 10) {
                const matchIndex = teamMatches[index][1];
                const points = simulation.get_match_points(matchIndex);
                let point = isHome ? points[1] : points[0];
                pointVanAll += point;
                element.innerText = formatPoint(point);
            } else {
                element.innerText = formatPoint(pointVanAll);
            }
        });
        let pointGeneralAll = 0;
        document.querySelectorAll('.modal-table .point-general td').forEach((element, index) => {
            const isHome = homeAwayArray[index] === 'HOME';
            if (index < 10) {
                const matchIndex = teamMatches[index][1];
                const points = simulation.get_match_points(matchIndex);
                let point = isHome ? points[3] : points[2];
                pointGeneralAll += point;
                element.innerText = formatPoint(point);
            } else {
                element.innerText = formatPoint(pointGeneralAll);
            }
        });
        ['team-van-rating', 'opponent-van-rating', 'team-general-rating', 'opponent-general-rating'].forEach((query, queryIndex) => {
            document.querySelectorAll(`.modal-table .${query} td`).forEach((element, index) => {
                if (index < 10) {
                    const isHome = homeAwayArray[index] === 'HOME';
                    const opponentTeamIndex = isHome ? teamMatches[index][0].team : teamMatches[index][0].opponent_team;
                    const targetTeamIndex = queryIndex % 2 === 0 ? teamIndex : opponentTeamIndex;
                    const targetIsHome = queryIndex % 2 === 0 ? isHome : !isHome;
                    const rawRating = simulation.get_rating(targetTeamIndex, targetIsHome, queryIndex > 1);
                    element.innerText = formatRating(rawRating);
                } else {
                    element.innerText = '-';
                }
            });
        });
        document.querySelector(`.modal-table .team-van-rating th`).innerText = `${allTeamNames[teamIndex]}の先鋒戦レート`;
        document.querySelector(`.modal-table .team-general-rating th`).innerText = `${allTeamNames[teamIndex]}の大将戦レート`;
    }

    drawTables();

    function applyRecordToForm() {
        for (let n = lastMatchIndex + 1; n < 60; n++) {
            const records = simulation.get_match_records(n);
            let pointAway = 0;
            let pointHome = 0;
            records.forEach((record) => {
                if (!record.is_valid || !record.point || record.is_prediction) {
                    return;
                }
                if (record.win_flag) {
                    pointAway += record.point;
                } else {
                    pointHome += record.point;
                }
            });
            const midActiveFlag = records[0].point || records[1].point || records[2].point;
            const generalActiveFlag = records[3].point || records[4].point || records[5].point;
            const extraActiveFlag = pointHome === 20 && pointAway === 20;
            ['van-1', 'van-2', 'van-3', 'mid-1', 'mid-2', 'mid-3', 'general-1', 'general-2', 'general-3', 'general-4', 'general-5', 'extra-1'].forEach((inputName, inputIndex) => {
                const radioElements = document.querySelectorAll(`input[name="${n}-${inputName}"]`);
                const record = records[inputIndex];
                if (record.is_valid && !record.is_prediction) {
                    if (record.win_flag) {
                        radioElements[0].checked = 'checked';
                        radioElements[1].checked = '';
                    } else {
                        radioElements[1].checked = 'checked';
                        radioElements[0].checked = '';
                    }
                } else if (inputIndex > 0) {
                    radioElements.forEach((element) => {
                        if (inputName === 'mid-1') {
                            element.disabled = midActiveFlag ? '' : 'disabled';
                        } else if (inputName === 'general-1') {
                            element.disabled = generalActiveFlag ? '' : 'disabled';
                        } else if (inputName === 'extra-1') {
                            element.disabled = extraActiveFlag ? '' : 'disabled';
                        } else {
                            element.disabled = 'disabled';
                        }
                        if (element.disabled) {
                            element.checked = '';
                        }
                    });
                }
                if (!midActiveFlag && inputIndex > 0 && inputIndex < 3 && records[inputIndex - 1].is_valid && !records[inputIndex - 1].point) {
                    radioElements.forEach((element) => element.disabled = '');
                }
                if (!generalActiveFlag && inputIndex > 2 && inputIndex < 6 && records[inputIndex - 1].is_valid && !records[inputIndex - 1].point) {
                    radioElements.forEach((element) => element.disabled = '');
                }
                if (!extraActiveFlag && inputIndex > 5 && inputIndex < 11 && records[inputIndex - 1].is_valid && !records[inputIndex - 1].point) {
                    radioElements.forEach((element) => element.disabled = '');
                }
                document.getElementById(`${n}-point-away`).innerText = pointAway.toString();
                document.getElementById(`${n}-point-home`).innerText = pointHome.toString();
            });
        }
    }

    function drawSimulationInputTable(matchIndex) {
        const currentMatchInfo = matches[matchIndex + 1];
        const simulationParent = document.getElementById(`simulation-parent-${currentMatchInfo.team < 6 ? 's' : 'f'}`);
        const h3 = document.createElement('h3');
        h3.innerHTML = `
            <span class="script-init" style="display: inline-block; width: 17em;">ディビジョン${currentMatchInfo.team < 6 ? 'S' : 'F'} 第${currentMatchInfo.section}節　${currentMatchInfo.date_expression.replace(/^0/, '').replace(/\/0/, '/')}開催</span>
            <button class="simulate">シミュレーション</button>
            <button class="simulation-clear" style="margin-right: 1em;" value="${matchIndex}">節をクリア</button>
            <label style="font-weight: normal;">
                <input type="checkbox" name="disable-rate" style="margin-right: 0">
                シミュレーションにレートを利用しない
            </label>
        `;
        simulationParent.appendChild(h3);
        [1, 2, 3].forEach((index) => {
            const matchInfo = matches[matchIndex + index];

            const setNames = [['van', 3], ['mid', 3], ['general', 5], ['extra', 1]];
            const table = document.createElement('table');
            simulationParent.appendChild(table);
            table.appendChild(document.createElement('thead'));
            const tbody = document.createElement('tbody');
            table.appendChild(tbody);
            {
                const tr = document.createElement('tr');
                tr.innerHTML = `
        <tr>
            <th colspan="2" style="width:8em;">第${index}試合</th>
            <td colspan="3">先鋒戦</td>
            <td colspan="3">中堅戦</td>
            <td colspan="5">大将戦</td>
            <td colspan="1">延長戦</td>
            <td>ポイント</td>
        </tr>`
                tbody.appendChild(tr);
            }
            ['away', 'home'].forEach((awayHome) => {

                let trHtml = `
            <th class="script-init">
                ${allTeamNames[awayHome === 'away' ? matchInfo.team : matchInfo.opponent_team]}
            </th>
            <th>
                ${awayHome === 'away' ? 'AWAY' : 'HOME'}
            </th>
            `;
                setNames.forEach((pair) => {
                    for (let i = 0; i < pair[1]; i++) {
                        trHtml += `
             <td>
                <label>
                    <input type="radio" name="${matchIndex + index}-${pair[0]}-${i + 1}" value="${awayHome === 'away' ? 1 : 0}">
                </label>
            </td>`
                    }
                });
                trHtml += `
            <td id="${matchIndex + index}-point-${awayHome}">
                0
            </td>`;
                const tr = document.createElement('tr');
                tr.innerHTML = trHtml;
                tbody.appendChild(tr);
            });
        });
    }

    for (let i = lastMatchIndex; i < 57; i = i + 3) {
        drawSimulationInputTable(i);
    }
    applyRecordToForm();

    document.querySelectorAll('.script-init').forEach((element) => element.style['visibility'] = 'visible');

    function inputOnchangeFunc() {
        const inputtedGameResults = [];
        for (let n = lastMatchIndex + 1; n < 60; n++) {
            let maxInputIndex = -1;
            const gameResults = [];
            ['van-1', 'van-2', 'van-3', 'mid-1', 'mid-2', 'mid-3', 'general-1', 'general-2', 'general-3', 'general-4', 'general-5', 'extra-1'].forEach((inputName, inputIndex) => {
                const radioElement = document.querySelector(`input[name="${n}-${inputName}"]:checked`);
                if (radioElement) {
                    maxInputIndex = inputIndex;
                }
                if (radioElement && radioElement.value === '1') {
                    gameResults.push(true);
                } else {
                    gameResults.push(false);
                }
            });
            gameResults.length = maxInputIndex + 1;
            inputtedGameResults.push(gameResults);
        }
        console.log(inputtedGameResults);
        const results = getDivisionResults();
        results.push(...inputtedGameResults);
        results.forEach((result, index) => {
            simulation.set_match_result(index, result);
        });
        applyRecordToForm();
        return inputtedGameResults
    }

    document.querySelectorAll('input[type="radio"]').forEach((element) => {
        element.onchange = function () {
            inputOnchangeFunc();
        }
    });
    document.querySelectorAll('[name=disable-rate]').forEach((element) => {
        element.onchange = function () {
            document.querySelectorAll('[name=disable-rate]').forEach((nested) => {
                nested.checked = element.checked;
            });
        }
    })
    document.querySelectorAll('.simulate').forEach((element) => {
        element.onclick = function () {
            const enableRate = document.querySelector('[name=disable-rate]:checked') === null;
            document.getElementById('loader').style['opacity'] = '70%';
            document.getElementById('loader').style['z-index'] = '100';
            setTimeout(() => {
                simulation.enable_rate(enableRate);
                const divisionResults = getDivisionResults();
                divisionResults.push(...inputOnchangeFunc());
                divisionResults.forEach((results, index) => {
                    simulation.set_match_result(index, results);
                });
                simulation.simulate();

                drawTables();
                document.getElementById('loader').style['opacity'] = '0';
                document.getElementById('loader').style['z-index'] = '-1';
            }, 10);
        }
    })
    document.querySelectorAll('.simulation-clear').forEach((element) => {
        element.onclick = function () {
            const matchIndex = Number(element.value);
            const enableRate = document.querySelector('#disable-rate:checked') === null;
            document.getElementById('loader').style['opacity'] = '70%';
            document.getElementById('loader').style['z-index'] = '100';
            setTimeout(() => {
                simulation.enable_rate(enableRate);
                const divisionResults = inputOnchangeFunc();
                [1, 2, 3].forEach((n) => {
                    let van1 = document.querySelector(`input[name="${matchIndex + n}-van-1"]:checked`);
                    if (van1) {
                        van1.checked = '';
                    }
                    divisionResults[matchIndex + n - 1] = [];
                });
                divisionResults.forEach((results, index) => {
                    simulation.set_match_result(index, results);
                });
                applyRecordToForm();
                simulation.simulate();
                drawTables();
                document.getElementById('loader').style['opacity'] = '0';
                document.getElementById('loader').style['z-index'] = '-1';
            }, 10);
        }
    });

    //要素を取得
    const modal = document.querySelector('.js-modal'),
        open = document.querySelector('.js-modal-open'),
        close = document.querySelector('.js-modal-close');

    //「閉じるボタン」をクリックしてモーダルを閉じる
    function modalClose() {
        modal.classList.remove('is-active');
    }

    close.addEventListener('click', modalClose);

    //「モーダルの外側」をクリックしてモーダルを閉じる
    function modalOut(e) {
        if (e.target === modal) {
            modal.classList.remove('is-active');
        }
    }

    addEventListener('click', modalOut);
</script>
</body>
</html>